# lab3 实验报告
学号 PB20000114 姓名 刘阳

## 实验要求
使用访问者模式来实现 IR 的自动生成
## 实验难点
+ 实验需要使用许多ligth ir以及type定义等库,需要仔细阅读文档及头文件
+ 函数调用,返回值以及表达式中的类型转换要考虑正确和全面
+ 对指针类型和数组类型要注意区分
+ 表达式中数组元素作为左指时要及时修改全局变量避免得到的是数组下标的左值而不是该元素的左值
+ 对while if以及数组等会带来新块的结构遇到多个该结构嵌套时造成块之间跳转关系失效

## 实验设计

请写明为了顺利完成本次实验，加入了哪些亮点设计，并对这些设计进行解释。
可能的阐述方向有:

全局变量:
+ Value *val:用来保存表达式的临时值
+ bool need_lvalue:记录当前是否需要返回左值
+ Function *cur_fun:记录当前函数
+ bool pre_enter_scope:用于控制是否在CompoundStmt中添加 scope.enter,scope.exit
  
困难问题解决:
+ 对库文件,仔细阅读文档并参考已有代码,同时充分利用ide工具及时查找类型与函数声明
+ 类型是否需要转换采用一个变量记录(可能提取成函数更好?)
+ 对左值需要保存到函数临时变量并及时修改,防止在递归到下一层时生效
+ while等结构需要在最后添加一个块,并从原有最后块直接跳转过去,从而保证块间关系的正确性
### 实验总结

本次实验,对中间代码的自动生成有了更多理解,同时也加深了对库代码的使用能力.

### 实验反馈 （可选 不计入评分）

本次实验开始时感觉无从下手,已有代码似乎不能起到很好例子效果,同时可能跟ligth ir以及AST等接口的代码加上注释会更好.
